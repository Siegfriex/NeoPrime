# NEO GOD Ultra Framework v2.3 중간보고서

**작성일**: 2026-01-26
**프로젝트**: 대입 예측 지능형 엔진 구축
**버전**: v2.3

---

## 1. 프로젝트 개요

### 1.1 목표
| 목표 | 설명 |
|------|------|
| 지능형 엔진 | 220개 대학별 환산점수 자동 계산 |
| 데이터 레이크 | BigQuery 기반 분석 자산 구축 |
| 시스템 파워 | 합불 예측 및 전략적 의사결정 지원 |

### 1.2 원본 데이터
- **파일**: `202511고속성장분석기(가채점)20251114.xlsx`
- **시트 수**: 14개
- **총 행 수**: 226,933행

---

## 2. 완료된 작업

### 2.1 BigQuery 데이터 적재 ✅

| 테이블명 | 행 수 | 상태 |
|----------|-------|------|
| tb_raw_2026_COMPUTE | 70 | ✅ |
| tb_raw_2026_INDEX | 1,516 | ✅ |
| tb_raw_2026_INFO | 23 | ✅ |
| tb_raw_2026_PERCENTAGE | 648 | ✅ |
| tb_raw_2026_RAWSCORE | 11,366 | ✅ |
| tb_raw_2026_RESTRICT | 217 | ✅ |
| tb_raw_2026_SUBJECT1 | 41 | ✅ |
| tb_raw_2026_SUBJECT2 | 41 | ✅ |
| tb_raw_2026_SUBJECT3 | 1,464 | ✅ |
| tb_raw_2026_내신입력 | 27 | ✅ |
| tb_raw_2026_문과계열분석결과 | 105,490 | ✅ |
| tb_raw_2026_수능입력 | 44 | ✅ |
| tb_raw_2026_원점수입력 | 44 | ✅ |
| tb_raw_2026_이과계열분석결과 | 105,942 | ✅ |
| **합계** | **226,933** | ✅ |

### 2.2 Logic Transpiler 개발 ✅

Excel 수식을 Python 코드로 자동 변환하는 트랜스파일러 구현

#### 지원 함수 매핑

| Excel 함수 | Python 변환 | 상태 |
|------------|-------------|------|
| IF | `(true_val if cond else false_val)` | ✅ |
| OR | `(a or b or c)` | ✅ |
| AND | `(a and b and c)` | ✅ |
| IFERROR | `_safe_eval(lambda: expr, fallback)` | ✅ |
| VLOOKUP | `_vlookup(lookup_val, table_ref, col_idx)` | ✅ |
| HLOOKUP | `_hlookup(lookup_val, table_ref, row_idx)` | ✅ |
| INDEX | `_index(array_ref, row, col)` | ✅ |
| MATCH | `_match(lookup_val, array_ref, match_type)` | ✅ |
| INDEX/MATCH 2D | `_index_match_2d(array_ref, row_match, col_match)` | ✅ |
| SUM | `sum([...])` | ✅ |
| AVERAGE | `np.nanmean([...])` | ✅ |
| MAX/MIN | `max([...])` / `min([...])` | ✅ |
| ROUND | `round(value, decimals)` | ✅ |
| & (문자열 결합) | `+` | ✅ |

#### 시트 참조 변환

```
수능입력!$C$18  →  sheets['수능입력']['C18']
COMPUTE!$A$1:$UG$72  →  'COMPUTE!A1:UG72'
$G6  →  row['G6']
```

### 2.3 대학별 환산점수 엔진 생성 ✅

- **파일**: `output/university_score_engine.py`
- **코드 라인**: 2,761줄
- **지원 대학**: 218개

#### 주요 대학 수식 변환 예시

| 대학 | 원본 수식 | Python 변환 |
|------|-----------|-------------|
| 서울대 | `=JL$58+JL$59+JL$60+JL$61+JL$62` | `row['JL58']+row['JL59']+row['JL60']+row['JL61']+row['JL62']` |
| 연세대 | `=MZ$58+MZ$59+MZ$60+MZ$61+MZ$62` | `row['MZ58']+row['MZ59']+row['MZ60']+row['MZ61']+row['MZ62']` |
| 고려대 | `=CE$58+CE$59+CE$60+CE$61+CE$62` | `row['CE58']+row['CE59']+row['CE60']+row['CE61']+row['CE62']` |

### 2.4 분석결과 엔진 생성 ✅

- **파일**: `output/analysis_result_engine.py`
- **지원 시트**: 이과계열분석결과, 문과계열분석결과

#### 컬럼별 수식 변환

| 컬럼 | 패턴 | 기능 |
|------|------|------|
| col_3 | conditional | 합불 판정 (5단계) |
| col_4 | index_match | COMPUTE에서 점수 조회 |
| col_5 | index_match | COMPUTE에서 점수 조회 |
| col_6 | aggregation | 총점 계산 |
| col_7 | aggregation | 평균 계산 |
| col_8 | conditional | 점수/만점 표시 |

---

## 3. 생성된 파일 목록

### 3.1 핵심 모듈

| 파일 | 설명 | 라인 수 |
|------|------|---------|
| `logic_transpiler.py` | 기본 트랜스파일러 | ~700 |
| `logic_transpiler_v2.py` | 확장 트랜스파일러 (복잡 수식) | ~650 |
| `column_mapper.py` | Excel↔BigQuery 컬럼 매핑 | ~180 |

### 3.2 생성된 엔진

| 파일 | 설명 | 라인 수 |
|------|------|---------|
| `output/university_score_engine.py` | 218개 대학 환산점수 엔진 | 2,761 |
| `output/analysis_result_engine.py` | 분석결과 계산 엔진 | ~200 |

### 3.3 메타데이터

| 파일 | 설명 |
|------|------|
| `output/column_mapping_v2.json` | 대학-컬럼 매핑 정보 |
| `output/*_formula_metadata.json` | 14개 시트별 수식 메타데이터 |
| `output/pipeline_report.json` | 파이프라인 실행 결과 |

### 3.4 테스트 스크립트

| 파일 | 설명 |
|------|------|
| `test_engine.py` | BigQuery 연동 테스트 v1 |
| `test_engine_v2.py` | 데이터 구조 분석 |
| `test_engine_v3.py` | 원본 데이터 테이블 분석 |

---

## 4. 기술적 발견사항

### 4.1 데이터 구조 분석

```
[Excel 수식 체인]
수능입력 (원점수)
    ↓
RAWSCORE/PERCENTAGE (변환표)
    ↓
COMPUTE (대학별 환산점수)
    ↓
이과/문과계열분석결과 (합불 예측)
```

### 4.2 BigQuery 테이블 현황

| 항목 | 내용 |
|------|------|
| 프로젝트 | neoprime0305 |
| 데이터셋 | ds_neoprime_entrance |
| 리전 | asia-northeast3 (서울) |
| 테이블 수 | 14개 |
| 총 행 수 | 226,933행 |

### 4.3 컬럼 매핑 분석

```python
# Excel 컬럼 → 대학명 매핑
{
    'F': '가천대',      # 인덱스 5
    'J': '가톨릭',      # 인덱스 9
    'JL': '서울대',     # 인덱스 271
    'MZ': '연세대',     # 인덱스 363
    'CE': '고려대',     # 인덱스 82
    ...  # 총 220개 대학
}

# 행 번호 → 영역 매핑
{
    58: '국어',
    59: '수학',
    60: '영어',
    61: '탐구1',
    62: '탐구2',
    63: '탐구평균',
    64: '한국사',
    65: '제2외국어'
}
```

---

## 5. 현재 제한사항

### 5.1 데이터 이슈

| 이슈 | 설명 | 영향 |
|------|------|------|
| 수식 미평가 | COMPUTE 테이블 값 대부분 0/NULL | 실제 점수 계산 불가 |
| 원본 데이터 없음 | 수능입력 시트에 테스트 데이터만 존재 | End-to-End 테스트 제한 |

### 5.2 트랜스파일러 제한

| 함수 | 현재 상태 | 비고 |
|------|----------|------|
| AVERAGE 내부 HLOOKUP | 부분 지원 | 중첩 함수 파싱 개선 필요 |
| 문자열 & 결합 내 셀 참조 | 부분 지원 | `$B6&" "&$C6` 변환 개선 필요 |

---

## 6. 다음 단계 (추천)

### 6.1 즉시 실행 가능

| 순위 | 작업 | 예상 효과 |
|------|------|----------|
| 1 | Excel "값으로 붙여넣기" 후 재적재 | COMPUTE 테이블에 실제 값 저장 |
| 2 | 테스트 점수 입력 후 검증 | End-to-End 파이프라인 검증 |

### 6.2 추가 개발

| 순위 | 작업 | 설명 |
|------|------|------|
| 1 | 중첩 함수 파싱 개선 | AVERAGE(HLOOKUP(...), HLOOKUP(...)) |
| 2 | 실시간 계산 API | FastAPI 기반 점수 계산 서비스 |
| 3 | 시각화 대시보드 | Streamlit/Dash 기반 UI |

---

## 7. 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────┐
│                    NEO GOD Ultra v2.3                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │ Excel 원본  │───▶│ Phase 1-3   │───▶│  BigQuery   │     │
│  │  (14시트)   │    │ (ETL 파이프) │    │ (14테이블)  │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                                     │             │
│         ▼                                     ▼             │
│  ┌─────────────┐                      ┌─────────────┐      │
│  │수식 메타데이터│                      │ 데이터 조회  │      │
│  │ (14 JSON)   │                      │             │      │
│  └─────────────┘                      └─────────────┘      │
│         │                                     │             │
│         ▼                                     ▼             │
│  ┌─────────────────────────────────────────────────┐       │
│  │           Logic Transpiler v2                   │       │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │       │
│  │  │ Parser  │─▶│Transpile│─▶│ Python Engine   │ │       │
│  │  │         │  │         │  │ (218개 대학)    │ │       │
│  │  └─────────┘  └─────────┘  └─────────────────┘ │       │
│  └─────────────────────────────────────────────────┘       │
│                          │                                  │
│                          ▼                                  │
│  ┌─────────────────────────────────────────────────┐       │
│  │              Output Engines                      │       │
│  │  • university_score_engine.py (2,761줄)         │       │
│  │  • analysis_result_engine.py (200줄)            │       │
│  └─────────────────────────────────────────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. 결론

### 8.1 달성률

| 목표 | 달성률 | 비고 |
|------|--------|------|
| BigQuery 적재 | 100% | 14개 테이블, 226,933행 |
| 수식 추출 | 100% | 14개 시트 메타데이터 |
| 트랜스파일러 | 90% | 주요 함수 모두 지원 |
| 대학 엔진 | 100% | 218개 대학 |
| 분석결과 엔진 | 80% | 6개 컬럼 변환 완료 |
| End-to-End 테스트 | 30% | 원본 데이터 부재로 제한 |

### 8.2 핵심 성과

1. **자동화 파이프라인 구축**: Excel → BigQuery 완전 자동화
2. **수식 트랜스파일러 개발**: 12개 Excel 함수 → Python 자동 변환
3. **218개 대학 엔진 생성**: 대학별 환산점수 계산 코드 자동 생성
4. **시트 참조 완전 지원**: `시트명!셀참조` → `sheets['시트명']['셀']`

---

**보고 종료**

*Generated by NEO GOD Ultra Framework v2.3*
