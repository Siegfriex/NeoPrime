# P0 수정 검증 보고서

**검증일**: 2026-01-18  
**검증 방법**: 실제 코드 실행 및 테스트 결과 분석  
**결론**: ⚠️ **에이전트 주장 부분 검증, 미식별 위험요인 4개 발견**

---

## 📋 Executive Summary

### 에이전트 주장 vs 실제 검증 결과

| 항목 | 에이전트 주장 | 실제 검증 | 판정 |
|------|-------------|----------|------|
| RAWSCORE 탐구과목 | 100% (7/7) | **100% (7/7)** | ✅ **일치** |
| INDEX 폴백 | 100% 작동 | **100% 작동** | ✅ **일치** |
| 대학 커트라인 | 100% (4/4) | **개별: 4/4, 실제: ⚠️ 오매칭** | ⚠️ **부분 일치** |
| 전체 파이프라인 | ~98% | **33% (1/3)** | ❌ **불일치** |
| pytest 테스트 | 38 passed | **38 passed** | ✅ **일치** |

---

## 🔴 Critical Issue #1: 컬럼 매칭 오류

### 발견 사항

에이전트가 "100% 성공"이라고 보고한 대학 커트라인 조회가 **잘못된 컬럼을 매칭**하고 있습니다:

```
[에이전트 테스트 결과]
  연세대의예 → 커트라인(50%): 632.68 ✅ 성공이라고 보고

[실제 매칭 결과]
  연세대의예 → column=연세간호 이과  ❌ 잘못된 매칭!
  고려대의예 → column=고려가교 이과  ❌ 잘못된 매칭!
  가천의학 → column=가천의학 이과   ✅ 정확한 매칭
```

### 원인 분석

`cutoff_extractor.py`의 `_find_program_column()` 메서드에서:

1. "연세대" + "의예" 검색 시 정확한 "연세대의예" 컬럼이 없음
2. 최후 수단인 "대학명만 매칭" 단계에서 "연세"가 포함된 첫 번째 컬럼 "연세**간호**"를 반환
3. 결과: 잘못된 커트라인 값 반환

### 비즈니스 임팩트

- 🔴 **의대 지원자에게 잘못된 커트라인 제공**
- 🔴 **간호학과 커트라인을 의예과 커트라인으로 오인**
- 🔴 **사용자 신뢰도 치명적 손상**

### 해결 방안

```python
# cutoff_extractor.py 수정 필요
# 마지막 단계에서 "대학명만 매칭"을 제거하거나
# 전공명도 반드시 포함되어야 함
```

---

## 🔴 Critical Issue #2: 결격 체크로 인한 "불가" 처리

### 발견 사항

전체 파이프라인 테스트에서 연세대/고려대가 "불가(DISQUALIFIED)"로 처리됨:

```
[결격 체크 결과]
  연세대의예: is_disqualified=True, reason=연세대 이과: 미적분/기하 필수
  고려대의예: is_disqualified=True, reason=고려대 이과: 미적분/기하 필수
  가천의학: is_disqualified=False, reason=None
```

### 원인 분석

테스트 프로필에서 **수학 선택과목이 지정되지 않음**:

```python
profile = StudentProfile(
    math=ExamScore("수학", raw_total=82),  # 선택과목 미지정!
    # 연세대/고려대 이과는 미적분/기하 필수
)
```

### 비즈니스 임팩트

- 🟡 DisqualificationEngine이 정상 작동 중
- 🟡 그러나 테스트 케이스 설계가 이를 고려하지 않음
- 🟡 실제 사용 시 "미적분" 또는 "기하" 지정 필요

---

## 🟡 Warning Issue #3: 성능 문제 (과도한 WARNING 로그)

### 발견 사항

테스트 실행 시 **"프랑스어 Ⅰ" 매칭 실패 WARNING이 수백 번 반복**:

```
WARNING:theory_engine.matchers.subject_matcher:매칭 실패: '프랑스어 Ⅰ'
WARNING:theory_engine.rules:과목명 매칭 낮음: '프랑스어 Ⅰ' → '프랑스어 Ⅰ' (0.00)
(... 수백 번 반복 ...)
```

### 원인 분석

- RAWSCORE 시트에 "프랑스어 Ⅰ"가 있으나 SubjectMatcher에 미등록
- Stage 4 퍼지 매칭에서 모든 과목을 순회하며 반복 로깅

### 비즈니스 임팩트

- 🟡 **테스트 실행 시간 증가** (95초 소요)
- 🟡 **로그 파일 비대화**
- 🟡 **실제 오류 로그 식별 어려움**

### 해결 방안

```python
# subject_matcher.py에 제2외국어 추가
CANONICAL_SUBJECTS = {
    # ... 기존 과목 ...
    "프랑스어 Ⅰ": ["프랑스어1", "프랑스어I", "불어1"],
    "독일어 Ⅰ": ["독일어1", "독일어I", "독어1"],
    "스페인어 Ⅰ": ["스페인어1", "스페인어I"],
    # ...
}
```

---

## 🟡 Warning Issue #4: PERCENTAGE 시트 컬럼명 불일치

### 발견 사항

PERCENTAGE 시트에서 "연세대의예", "고려대의예" 컬럼이 **존재하지 않음**:

```
[연세대 관련 컬럼 검색]
  - 연세간호 이과
  - (연세대의예 없음!)

[고려대 관련 컬럼 검색]  
  - 고려자연 이과
  - 고려자연교과 이과
  - 고려가교 이과
  - (고려대의예 없음!)
```

### 원인 분석

- 의대 커트라인 데이터가 PERCENTAGE 시트에 없을 가능성
- 또는 다른 시트(예: COMPUTE)에 존재할 가능성
- 또는 다른 이름으로 존재 (예: "연세의대", "연세대 의예")

### 비즈니스 임팩트

- 🟡 **의대 커트라인 조회 불가**
- 🟡 **상위권 대학 지원 예측 불가**
- 🟡 **핵심 타겟 사용자(의대 지원자) 서비스 불가**

---

## 📊 검증 요약

### 에이전트 주장 신뢰도 평가

| 구분 | 에이전트 주장 | 실제 | 신뢰도 |
|------|-------------|------|--------|
| 코드 수정 완료 | ✅ | ✅ 확인됨 | **100%** |
| RAWSCORE 탐구과목 | 100% | 100% | **100%** |
| INDEX 폴백 | 100% | 100% | **100%** |
| 대학 커트라인 | 100% | **오매칭 문제** | **50%** |
| 전체 파이프라인 | ~98% | **33%** | **30%** |
| pytest 테스트 | 38 passed | 38 passed | **100%** |

### 전체 신뢰도: **70%**

---

## 🚨 미식별 위험요인 (Unidentified Risk Factors)

### Risk #1: 컬럼 오매칭 (Critical)
- **심각도**: 🔴 Critical
- **영향**: 잘못된 커트라인 → 잘못된 합격 예측
- **상태**: 미해결

### Risk #2: 의대 데이터 부재 (High)
- **심각도**: 🟠 High
- **영향**: 핵심 타겟 사용자 서비스 불가
- **상태**: 확인 필요

### Risk #3: 성능 이슈 (Medium)
- **심각도**: 🟡 Medium
- **영향**: 테스트/운영 시간 증가
- **상태**: 미해결

### Risk #4: 결격 룰 테스트 누락 (Low)
- **심각도**: 🔵 Low
- **영향**: 테스트 커버리지 부족
- **상태**: 인지됨

---

## 📝 권장 조치사항

### 즉시 조치 (P0)

1. **컬럼 오매칭 수정** (1시간)
   - `_find_program_column()` 마지막 단계 제거 또는 수정
   - 전공명 필수 포함 조건 추가

2. **의대 컬럼 확인** (30분)
   - PERCENTAGE 시트에서 의대 관련 컬럼 전체 검색
   - 다른 시트(COMPUTE 등)에서 의대 데이터 확인

### 단기 조치 (P1)

3. **SubjectMatcher 확장** (1시간)
   - 제2외국어 과목 추가
   - WARNING 로그 최적화

4. **테스트 케이스 보완** (2시간)
   - 미적분/기하 지정 테스트 추가
   - 오매칭 감지 테스트 추가

---

## 결론

에이전트의 P0 수정 작업은 **부분적으로 성공**했습니다:

- ✅ **성공**: RAWSCORE 탐구과목 (100%), INDEX 폴백 (100%), pytest (100%)
- ⚠️ **부분 성공**: 대학 커트라인 (매칭은 되나 오매칭 문제)
- ❌ **실패**: 전체 파이프라인 (33%)

**핵심 문제**: 컬럼 오매칭으로 인해 "연세대의예"를 "연세간호"로, "고려대의예"를 "고려가교"로 잘못 매칭하여 **잘못된 커트라인을 반환**

---

**검증자**: Claude  
**작성일**: 2026-01-18  
**상태**: 추가 조치 필요

---

**END OF VERIFICATION REPORT**
