# NULL/0 값 처리 제1원칙

> **"0이면 다른 곳에 정당한 값이 있다"**

---

## 원칙 정의

Excel 또는 데이터베이스에서 NULL/0 값을 만났을 때, 단순히 "데이터 없음"으로 판단하지 말고 **다른 위치에 동등한 자격의 값이 존재하는지** 반드시 탐색한다.

### 핵심 질문
1. 이 값이 0인 이유가 무엇인가?
2. 같은 의미의 데이터가 다른 컬럼/Row에 있는가?
3. 다른 이름으로 저장되어 있는가?
4. 변형(.1, .2) 컬럼에 값이 있는가?

---

## 사례 연구: NEO GOD Score Calculator v1→v6

### 배경
대학입시 수능 환산점수 계산 시스템에서 주요 대학들의 점수가 0으로 나오는 문제 발생.

### 발견된 갭 유형

---

## 갭 유형 1: 대학명 매핑 불일치

### 증상
```
서울시립대 → N/A (컬럼 없음)
한국외대 → N/A (컬럼 없음)
카이스트 → N/A (컬럼 없음)
```

### 분석 과정
```python
# 부분 매칭으로 실제 컬럼명 탐색
for col in df.columns:
    if '시립' in col:
        print(col)  # → '시립대' 발견!
```

### 발견
| 검색명 | 실제 컬럼명 | 이유 |
|--------|------------|------|
| 서울시립 | 시립대 | 약칭 사용 |
| 한국외대 | 외국어 | 약칭 사용 |
| 카이스트 | 과기원 | 내부 코드명 |

### 해결 (v4)
```python
UNIV_NAME_MAP = {
    '서울시립': '시립대',
    '한국외대': '외국어',
    '카이스트': '과기원',
}
```

### 교훈
> **동일 엔티티가 다른 이름으로 저장될 수 있다. 매핑 테이블 필수.**

---

## 갭 유형 2: Row 구조 오해

### 증상
```
연세대 국어환산 = 380 (Row 57)
연세대 수학환산 = 0 (Row 58)
연세대 영어환산 = 0 (Row 59)
```

### 분석 과정
```python
# Row 라벨 확인
for row in range(55, 66):
    label = df.iloc[row].get('Unnamed: 1')
    print(f'Row {row}: {label}')
```

### 발견
```
Row 57: 수능환산(필수)   ← 국어가 아니라 "필수 영역 총점"!
Row 58: 수능환산(선택)   ← 수학이 아니라 "선택 영역 총점"!
Row 59: 수능환산(가중택) ← 영어가 아니라 "가중택 영역 총점"!

실제 개별 과목:
Row 9: 국어
Row 13: 수학
Row 16: 영어
```

### 해결 (v5)
```python
ROW_MAP = {
    '국어': 9,      # 개별 과목
    '수학': 13,
    '영어': 16,
    '필수총점': 57,  # 영역 총점
    '가중택총점': 59,
}
```

### 교훈
> **Row/Column의 실제 의미를 라벨로 검증하라. 위치 기반 가정은 위험하다.**

---

## 갭 유형 3: 변형 컬럼 미탐색

### 증상
```
서울대 국어 = 0
서울대 총점 = 0
```

### 분석 과정
```python
# 변형 컬럼 탐색
variants = [c for c in df.columns if c.startswith('서울대')]
print(variants)  # → ['서울대', '서울대.1', '서울대.2', '서울대.3']

# 각 변형의 값 확인
for v in variants:
    print(f'{v}: {df.iloc[57].get(v)}')
# 서울대: 0
# 서울대.1: 140  ← 값 있음!
# 서울대.2: 136
```

### 발견
- 기본 컬럼(서울대)은 "가중택" 유형 → 계산 조건 미충족으로 0
- 변형 컬럼(서울대.1)은 "필수" 유형 → 실제 값 존재

### 해결 (v3)
```python
def find_best_variant(base_name, df):
    variants = [c for c in df.columns if c.startswith(f'{base_name}.')]
    # 값이 있고, 설정이 완전한 변형 우선 선택
```

### 교훈
> **기본 컬럼이 0이면 변형 컬럼(.1, .2, ...)을 반드시 탐색하라.**

---

## 갭 유형 4: 설정 완전성 미고려

### 증상
```
홍익대 총점 = 12점 (예상보다 낮음)
인하대 총점 = 436점 (더 높은 변형 존재)
```

### 분석 과정
```python
# 설정 문자열 비교
홍익대:   설정 = "영"        (영어만)     → 12점
홍익대.1: 설정 = "국수영탐(2)" (전과목)    → 57점

인하대:   설정 = "영"        → 가중택총점 사용
인하대.2: 설정 = "국수영탐(2)" → 필수총점 486점
```

### 발견
- 불완전한 설정("영"만)이 우선 선택됨
- 완전한 설정("국수영탐")의 변형이 무시됨

### 해결 (v6.1)
```python
# 설정 완전성 점수
completeness = 0
if '국' in config: completeness += 100
if '수' in config: completeness += 100
if '영' in config: completeness += 50
if '탐' in config: completeness += 50

# 선택 우선순위: 값 크기 > 설정 완전성 > 유형
score = value_amount + completeness + type_score
```

### 교훈
> **설정/조건의 "완전성"을 정량화하여 최적 선택 기준에 포함하라.**

---

## 갭 유형 5: 계산 방식 차이

### 증상
```
성균관: 개별과목 합 = 199
성균관: 실제 총점 = 397 (Row 59)
차이 = 198점
```

### 분석 과정
```python
# 가중택 대학의 설정 확인
설정: "국수영탐(2)中가중택4"
의미: 국,수,영,탐(2) 중에서 상위 4개 선택

# 개별 합산 vs 가중택총점
개별합: 국어(99) + 수학(0) + 영어(100) = 199
가중택총점(Row 59): 397  ← 다른 계산 방식 적용됨
```

### 발견
- "가중택" 대학은 개별과목 단순 합산이 아님
- Excel 내부에서 복잡한 가중 계산 후 Row 59에 저장
- 개별과목 Row는 중간 결과일 뿐

### 해결 (v6)
```python
if source == '가중택':
    # 개별 합산 대신 가중택총점(Row 59) 직접 사용
    return scores['가중택총점']
```

### 교훈
> **유형별로 다른 계산 로직이 적용될 수 있다. 총점 Row가 있으면 그것을 신뢰하라.**

---

## 갭 유형 6: 동일 Row 중복 사용

### 증상
```
v4에서:
연세대 수학 = 158.3 (Row 46)
연세대 영어 = 158.3 (Row 47)
수학 = 영어? 이상함
```

### 분석 과정
```python
# Row 46 vs 47 비교
same_count = sum(1 for c in df.columns if df.iloc[46].get(c) == df.iloc[47].get(c))
print(f'동일: {same_count}')  # → 552개 (거의 전부 동일)
```

### 발견
- Row 46과 47은 거의 동일한 데이터
- "수학"이라고 가정했던 Row 46은 실제로 영어 관련 데이터
- Fallback 로직이 잘못된 Row를 사용

### 해결 (v5)
```python
# Fallback 제거, 정확한 Row만 사용
scores = {
    '수학': df.iloc[13].get(variant),  # Row 13 고정
    '영어': df.iloc[16].get(variant),  # Row 16 고정
}
```

### 교훈
> **Fallback Row는 검증 없이 사용하지 말라. 동일 데이터 중복 저장 가능성 확인.**

---

## 적용 체크리스트

### 데이터 로드 후 필수 점검

- [ ] NULL/0 비율이 예상과 다른 컬럼 식별
- [ ] 컬럼/Row 라벨 실제 의미 확인
- [ ] 유사 이름 컬럼 존재 여부 (매핑 필요성)
- [ ] 변형 컬럼(.1, .2) 존재 여부
- [ ] 총점 Row vs 개별 Row 구분

### NULL/0 발견 시 탐색 순서

1. **같은 엔티티, 다른 이름** → 매핑 테이블
2. **같은 엔티티, 다른 변형** → .1, .2 컬럼 탐색
3. **같은 의미, 다른 Row** → 라벨 기반 Row 재탐색
4. **다른 계산 방식** → 총점 Row 직접 사용
5. **진짜 데이터 없음** → 원본 입력 확인

---

## 버전 히스토리

| 버전 | 해결 갭 | 핵심 변경 |
|------|--------|----------|
| v1 | - | 기본 구현 |
| v2 | 가중택 유형 | Row 63/65 분기 |
| v3 | 변형 컬럼 | .1, .2 탐색 |
| v4 | 대학명 매핑 | UNIV_NAME_MAP |
| v5 | Row 구조 | 개별과목 Row 9,13,16 |
| v6 | 가중택 총점 | Row 59 직접 사용 |
| v6.1 | 설정 완전성 | completeness 점수 |

---

## 결론

> **NULL/0은 "없음"이 아니라 "다른 곳에 있음"의 신호일 수 있다.**

이 원칙을 적용하여 8개의 갭을 해결하고, 대학별 점수 정확도를 크게 개선했다.

```
v1 총점 합계: ~3,000점
v6 총점 합계: ~7,500점 (+150% 향상)
```

---

*문서 작성: 2026-01-26*
*적용 프로젝트: NEO GOD Ultra Framework v2.3*
